{%- set required_extensions = [] -%}
{%- set recommended_extensions = [] -%}
{%- set all_extensions_seen = [] -%}

{# Language extensions from enhanced templates #}
{%- for language in metadata.languages -%}
  {%- set enhanced_config = load_enhanced_language_config(language) -%}
  {%- if enhanced_config and enhanced_config.languages and enhanced_config.languages[language] -%}
    {%- set lang_config = enhanced_config.languages[language] -%}
    {# Add required extensions #}
    {%- if lang_config.required_extensions -%}
      {%- for ext in lang_config.required_extensions -%}
        {%- if ext not in all_extensions_seen -%}
          {%- set _ = required_extensions.append(ext) -%}
          {%- set _ = all_extensions_seen.append(ext) -%}
        {%- endif -%}
      {%- endfor -%}
    {%- endif -%}
    {# Add recommended extensions #}
    {%- if lang_config.recommended_extensions -%}
      {%- for ext in lang_config.recommended_extensions -%}
        {%- if ext not in all_extensions_seen -%}
          {%- set _ = recommended_extensions.append(ext) -%}
          {%- set _ = all_extensions_seen.append(ext) -%}
        {%- endif -%}
      {%- endfor -%}
    {%- endif -%}
  {%- endif -%}
{%- endfor -%}

{# Platform extensions (treat as required for platform functionality) #}
{%- if metadata.platform == 'github' -%}
  {%- set platform_required = ['github.vscode-pull-request-github'] -%}
  {%- set platform_recommended = ['github.copilot', 'github.copilot-chat'] -%}
{%- elif metadata.platform == 'azuredevops' -%}
  {%- set platform_required = ['ms-vsts.team'] -%}
  {%- set platform_recommended = [] -%}
{%- else -%}
  {%- set platform_required = [] -%}
  {%- set platform_recommended = [] -%}
{%- endif -%}

{# Add platform extensions to appropriate arrays #}
{%- for ext in platform_required -%}
  {%- if ext not in all_extensions_seen -%}
    {%- set _ = required_extensions.append(ext) -%}
    {%- set _ = all_extensions_seen.append(ext) -%}
  {%- endif -%}
{%- endfor -%}
{%- for ext in platform_recommended -%}
  {%- if ext not in all_extensions_seen -%}
    {%- set _ = recommended_extensions.append(ext) -%}
    {%- set _ = all_extensions_seen.append(ext) -%}
  {%- endif -%}
{%- endfor -%}

{
	"recommendations": [
{%- if required_extensions %}

		// Required extensions (essential for language functionality)
{% for ext in required_extensions | sort %}
		"{{ ext }}",
{% endfor %}{% endif %}{%- if recommended_extensions %}
		// Recommended extensions (optional but helpful)
{% for ext in recommended_extensions | sort %}
		"{{ ext }}",
{% endfor %}{% endif %}	]
}